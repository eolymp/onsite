# Onsite Proxy

Цей SOCK5 проксі-сервер призначений для обмеження доступу до Інтернету під час змагань з програмування. Він простий у використанні, але надає лише обмежені функції фільтрації, які може обійти досвідчений зловмисник.

# Встановлення

Проксі-сервер повинен бути встановлений на сервері з доступом до локальної мережі та доступний з робочих станцій учасника.

1. Налаштуйте виділений сервер у локальній мережі, який працюватиме як проксі. Цей сервер повинен мати доступ до Інтернету та бути доступним з робочих станцій учасника.
2. Завантажте останню версію Onsite Proxy зі [сторінки релізу](https://github.com/eolymp/onsite/releases) для вашої ОС (Windows/Linux/macOS).
3. Завантажте приклад файлу конфігурації під назвою `config.yaml.dist` зі [сторінки релізу](https://github.com/eolymp/onsite/releases).
4. Перейменуйте `config.yaml.dist` на `config.yaml` і змініть конфігурацію відповідно до ваших вимог.
5. Запустіть Onsite Proxy
6. Налаштуйте робочі станції вашого учасника на використання Onsite Proxy як проксі-сервера (див. нижче).

Щоб Onsite Proxy був ефективним, робочі станції учасника не повинні мати доступу до Інтернету: наприклад знаходитися в локальній мережі, яка не має доступу до Інтернету, або обмежує весь трафік (включаючи DNS) для робочих станцій учасника.
Якщо учасник вимкне конфігурацію проксі-сервера, його робоча станція не повинна надавати йому доступ до Інтернету.

## Конфігурація

Мета Onsite Proxy — бути простим і легким, тому він не перевіряє трафік і застосовує лише правила фільтрації на рівнях DNS і мережі.

### DNS фільтрація

Проксі-сервер діє як сервер DNS, він отримує DNS запити, перевіря доменні імена згідно з внутрішнім списком, і якщо ім'я дозволене, перенаправляє запит до DNS-сервера за замовчуванням. Ви можете вказати, які доменні імена дозволені в `config.yaml`.

```yaml
allowed_domains:
   - "*.eolymp.com"
forbidden_domains:
   - "eolymp.com"
```

Доменні імена можна вказати повністю або як шаблони із символом підстановки `*`. Символ підстановки відповідатиме одному цілому сегменту доменного імені, розділеного ".". Наприклад, шаблон `*.xyz` відповідатиме будь-якому субдомену першого рівня `xyz`, за винятком самого `xyz` або субдоменів другого+ рівня.

Якщо `allowed_domains` порожній або не взагалі на вказано, усі домени, крім перелічених у `forbidden_domains`, будуть дозволені.

Ми рекомендуємо вказувати `allowed_domains`, щоб явно вказати ресурси, які будуть доступні під час змагання.

### Мережева фільтрація

Фільтрація мережі дозволяє вказати IP-адреси та порти, які будуть доступні учасникам. Ви можете використовувати наступну конфігурацію:

```yaml
# Фільтр IP-адрес призначення
allowed_ip: ["1.1.1.1", "8.8.8.8"]
forbidden_ip: ["127.0.0.1"]

# Фільтр портів призначення
allowed_ports: [80, 443]
forbidden_ports: [22]
```

Ці параметри не підтримують шаблони та будуть зіставлені як є.

Якщо `allowed_ip` порожній, будуть дозволені всі адреси, крім тих, що вказані в `forbidden_ip`. З іншого боку, якщо `allowed_ip` не порожній, лише вказані IP-адреси будуть дозволені, тому немає необхідності вказувати `forbidden_ip`. Так само, якщо `allowed_ports` порожній, усі порти будуть дозволені, крім тих, що вказані в `forbidden_ports`.

Вказання точних IP-адрес серверів може бути виснажливим процесом, який може викликати помилки, тому наш проксі сервер дозволяє автоматично заповнювати `allowed_ip` IP-адресами, отриманими під час розпізнавання доменних імен. Ви можете ввімкнути цю функцію, встановивши опцію `allow_resolved_ips`.

```yaml
allow_resolved_ips: true
```

Ця конфігурація автоматично додасть IP-адреси, які повертає DNS сервер, до `allowed_ip`.

### Рекомендована конфігурація

Рекомендований спосіб налаштування проксі-сервера – використовувати ці параметри: `allowed_domains`, `allowed_ports` і `allow_resolved_ips` рівний `true`. Таким чином, DNS сервер відповідатиме лише на запити до імен перерахованих в `allowed_domains` і дозволятиме підключатись лише на IP-адреси, які повернув DNS сервер.

## Налаштувати проксі на робочих станціях

Кожна робоча станція має бути налаштована на використання Onsite Proxy як проксі-сервера. Для типу проксі-сервера має бути встановлено `SOCK5`, адреса має відповідати IP-адресі сервера, на якому встановлено Onsite Proxy, а для порту має бути встановлено `8000` (або інший, як зазначено в `config.yaml`). Якщо в конфігурації є опція «Використовувати проксі для вирішення DNS», цю опцію слід увімкнути.

Ви повинні мати можливість налаштувати проксі-сервер у мережевих налаштуваннях вашої ОС, хоча деякі браузери дозволяють вручну змінювати конфігурацію проксі у власних налаштуваннях (наприклад, [Firefox](https://support.mozilla.org/uk/kb/nalashtuvannya-merezhi-v-firefox)).

<p align="center">
   <img width="675" alt="Конфігурація проксі-сервера в Firefox" src="https://github.com/eolymp/onsite/assets/576301/3b4ea976-91d1-48d5-9511-a1e2596abf26" >

<p align="center">
   <i>Конфігурація проксі-сервера в Firefox</i>
